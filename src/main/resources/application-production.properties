# ===========================================
# PRODUCTION PROFILE CONFIGURATION
# ===========================================
# This profile is optimized for production environments
# Requires external database configuration via environment variables

# Database Configuration - MUST be set via environment variables
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=${DB_DRIVER}

# JPA Configuration for Production
spring.jpa.database-platform=${DB_DIALECT}
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Connection Pool Optimization for Production
spring.datasource.hikari.maximum-pool-size=${DB_POOL_MAX_SIZE:50}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:10}
spring.datasource.hikari.idle-timeout=${DB_POOL_IDLE_TIMEOUT:300000}
spring.datasource.hikari.max-lifetime=${DB_POOL_MAX_LIFETIME:1200000}
spring.datasource.hikari.connection-timeout=${DB_POOL_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.leak-detection-threshold=${DB_POOL_LEAK_DETECTION:60000}

# Enable Flyway for Production Schema Management
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# Production Logging (minimal)
logging.level.root=WARN
logging.level.com.ecommerce.user=INFO
logging.level.org.springframework.security=WARN

# Production JWT Settings - MUST be set via environment variables
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:3600000}
jwt.issuer=${JWT_ISSUER:ecommerce-authentication-service}

# CORS - Restrict to specific origins in production
cors.allowed-origins=${CORS_ALLOWED_ORIGINS}

# Security
security.debug=false

# H2 Console - Disabled in production
spring.h2.console.enabled=false

# ===========================================
# FEATURE TOGGLES - PRODUCTION
# ===========================================
# Authentication features
features.auth.mfa.enabled=${FEATURE_MFA_ENABLED:true}
features.auth.social-login.enabled=${FEATURE_SOCIAL_LOGIN_ENABLED:true}
features.auth.password-reset.enabled=${FEATURE_PASSWORD_RESET_ENABLED:true}
features.auth.rate-limiting.enabled=${FEATURE_RATE_LIMITING_ENABLED:true}

# Security features
features.security.audit-logging.enabled=${FEATURE_AUDIT_LOGGING_ENABLED:true}
features.security.session-management.enabled=${FEATURE_SESSION_MANAGEMENT_ENABLED:true}
features.security.csrf-protection.enabled=${FEATURE_CSRF_PROTECTION_ENABLED:true}

# Integration features
features.integration.kafka.enabled=${FEATURE_KAFKA_ENABLED:true}
features.integration.redis.enabled=${FEATURE_REDIS_ENABLED:true}
features.integration.email.enabled=${FEATURE_EMAIL_ENABLED:true}

# Monitoring features
features.monitoring.actuator.enabled=${FEATURE_ACTUATOR_ENABLED:true}
features.monitoring.metrics.enabled=${FEATURE_METRICS_ENABLED:true}
features.monitoring.health-checks.enabled=${FEATURE_HEALTH_CHECKS_ENABLED:true}

# Business features
features.business.gdpr-compliance.enabled=${FEATURE_GDPR_ENABLED:true}
features.business.user-analytics.enabled=${FEATURE_USER_ANALYTICS_ENABLED:true}
features.business.automated-cleanup.enabled=${FEATURE_AUTOMATED_CLEANUP_ENABLED:true}

# Production specific features
features.prod.circuit-breaker.enabled=${FEATURE_CIRCUIT_BREAKER_ENABLED:true}
features.prod.performance-monitoring.enabled=${FEATURE_PERFORMANCE_MONITORING_ENABLED:true}
features.prod.backup-automation.enabled=${FEATURE_BACKUP_AUTOMATION_ENABLED:true}

# ===========================================
# ACTUATOR CONFIGURATION - PRODUCTION
# ===========================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
management.security.enabled=true

# ===========================================
# PERFORMANCE TUNING - PRODUCTION
# ===========================================
# Server configuration
server.tomcat.threads.max=${TOMCAT_MAX_THREADS:200}
server.tomcat.threads.min-spare=${TOMCAT_MIN_THREADS:10}
server.tomcat.accept-count=${TOMCAT_ACCEPT_COUNT:100}
server.tomcat.max-connections=${TOMCAT_MAX_CONNECTIONS:8192}

# JPA Performance
spring.jpa.properties.hibernate.jdbc.batch_size=${HIBERNATE_BATCH_SIZE:25}
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# ===========================================
# SECURITY HARDENING - PRODUCTION
# ===========================================
server.error.include-stacktrace=never
server.error.include-message=never
server.error.include-binding-errors=never

# SSL Configuration
server.ssl.enabled=${SSL_ENABLED:false}
server.ssl.key-store=${SSL_KEYSTORE_PATH:}
server.ssl.key-store-password=${SSL_KEYSTORE_PASSWORD:}
server.ssl.key-store-type=${SSL_KEYSTORE_TYPE:PKCS12}

# ===========================================
# MONITORING & OBSERVABILITY
# ===========================================
# Micrometer metrics
management.metrics.export.prometheus.enabled=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=production